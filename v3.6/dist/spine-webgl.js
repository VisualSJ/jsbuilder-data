!function(){sp.Skeleton.WebGLRenderCmd=function(a){cc.Node.WebGLRenderCmd.call(this,a),this._needDraw=!0,this.setShaderProgram(cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),this._tmpQuad=new cc.V3F_C4B_T2F_Quad};var a=sp.Skeleton.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=sp.Skeleton.WebGLRenderCmd,a.rendering=function(a){var b=this._node,c=this._tmpQuad;this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._stackMatrix);var d=b.getColor(),e=b._skeleton;e.r=d.r/255,e.g=d.g/255,e.b=d.b/255,e.a=b.getOpacity()/255,b._premultipliedAlpha&&(e.r*=e.a,e.g*=e.a,e.b*=e.a);var f,g,h,i,j,k,l=b._blendFunc;for(j=0,k=e.drawOrder.length;k>j;j++)if(i=e.drawOrder[j],i.attachment){switch(h=i.attachment,i.attachment.type){case sp.ATTACHMENT_TYPE.REGION:this._updateRegionAttachmentQuad(h,i,c,b._premultipliedAlpha);break;case sp.ATTACHMENT_TYPE.MESH:this._updateMeshAttachmentQuad(h,i,c,b._premultipliedAlpha);break;case sp.ATTACHMENT_TYPE.SKINNED_MESH:break;default:continue}var m=b.getTextureAtlas(h);i.data.additiveBlending!=f?(g&&(g.drawQuads(),g.removeAllQuads()),f=!f,cc.glBlendFunc(l.src,f?cc.ONE:l.dst)):m!=g&&g&&(g.drawQuads(),g.removeAllQuads()),g=m;var n=g.getTotalQuads();if(g.getCapacity()==n&&(g.drawQuads(),g.removeAllQuads(),!g.resizeCapacity(2*g.getCapacity())))return;g.updateQuad(c,n)}if(g&&(g.drawQuads(),g.removeAllQuads()),b._debugBones||b._debugSlots){cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.current_stack.stack.push(cc.current_stack.top),cc.current_stack.top=this._stackMatrix;var o=cc._drawingUtil;if(b._debugSlots)for(o.setDrawColor(0,0,255,255),o.setLineWidth(1),j=0,k=e.slots.length;k>j;j++)if(i=e.drawOrder[j],i.attachment&&i.attachment.type==sp.ATTACHMENT_TYPE.REGION){h=i.attachment,this._updateRegionAttachmentQuad(h,i,c);var p=[];p.push(cc.p(c.bl.vertices.x,c.bl.vertices.y)),p.push(cc.p(c.br.vertices.x,c.br.vertices.y)),p.push(cc.p(c.tr.vertices.x,c.tr.vertices.y)),p.push(cc.p(c.tl.vertices.x,c.tl.vertices.y)),o.drawPoly(p,4,!0)}if(b._debugBones){var q;for(o.setLineWidth(2),o.setDrawColor(255,0,0,255),j=0,k=e.bones.length;k>j;j++){q=e.bones[j];var r=q.data.length*q.m00+q.worldX,s=q.data.length*q.m10+q.worldY;o.drawLine(cc.p(q.worldX,q.worldY),cc.p(r,s))}for(o.setPointSize(4),o.setDrawColor(0,0,255,255),j=0,k=e.bones.length;k>j;j++)q=e.bones[j],o.drawPoint(cc.p(q.worldX,q.worldY)),0==j&&o.setDrawColor(0,255,0,255)}cc.kmGLPopMatrix()}},a._createChildFormSkeletonData=function(){},a._updateChild=function(){},a._updateRegionAttachmentQuad=function(a,b,c,d){var e={};a.computeVertices(b.bone.skeleton.x,b.bone.skeleton.y,b.bone,e);var f=b.bone.skeleton.r*b.r*255,g=b.bone.skeleton.g*b.g*255,h=b.bone.skeleton.b*b.b*255,i=b.bone.skeleton.a*b.a;d&&(f*=i,g*=i,h*=i);var j=255*i;c.bl.colors.r=c.tl.colors.r=c.tr.colors.r=c.br.colors.r=f,c.bl.colors.g=c.tl.colors.g=c.tr.colors.g=c.br.colors.g=g,c.bl.colors.b=c.tl.colors.b=c.tr.colors.b=c.br.colors.b=h,c.bl.colors.a=c.tl.colors.a=c.tr.colors.a=c.br.colors.a=j;var k=sp.VERTEX_INDEX;c.bl.vertices.x=e[k.X1],c.bl.vertices.y=e[k.Y1],c.tl.vertices.x=e[k.X2],c.tl.vertices.y=e[k.Y2],c.tr.vertices.x=e[k.X3],c.tr.vertices.y=e[k.Y3],c.br.vertices.x=e[k.X4],c.br.vertices.y=e[k.Y4],c.bl.texCoords.u=a.uvs[k.X1],c.bl.texCoords.v=a.uvs[k.Y1],c.tl.texCoords.u=a.uvs[k.X2],c.tl.texCoords.v=a.uvs[k.Y2],c.tr.texCoords.u=a.uvs[k.X3],c.tr.texCoords.v=a.uvs[k.Y3],c.br.texCoords.u=a.uvs[k.X4],c.br.texCoords.v=a.uvs[k.Y4]},a._updateMeshAttachmentQuad=function(a,b,c,d){var e={};a.computeWorldVertices(b.bone.x,b.bone.y,b,e);var f=b.bone.skeleton.r*b.r*255,g=b.bone.skeleton.g*b.g*255,h=b.bone.skeleton.b*b.b*255,i=b.bone.skeleton.a*b.a;d&&(f*=i,g*=i,h*=i);var j=255*i;c.bl.colors.r=c.tl.colors.r=c.tr.colors.r=c.br.colors.r=f,c.bl.colors.g=c.tl.colors.g=c.tr.colors.g=c.br.colors.g=g,c.bl.colors.b=c.tl.colors.b=c.tr.colors.b=c.br.colors.b=h,c.bl.colors.a=c.tl.colors.a=c.tr.colors.a=c.br.colors.a=j;var k=sp.VERTEX_INDEX;c.bl.vertices.x=e[k.X1],c.bl.vertices.y=e[k.Y1],c.tl.vertices.x=e[k.X2],c.tl.vertices.y=e[k.Y2],c.tr.vertices.x=e[k.X3],c.tr.vertices.y=e[k.Y3],c.br.vertices.x=e[k.X4],c.br.vertices.y=e[k.Y4],c.bl.texCoords.u=a.uvs[k.X1],c.bl.texCoords.v=a.uvs[k.Y1],c.tl.texCoords.u=a.uvs[k.X2],c.tl.texCoords.v=a.uvs[k.Y2],c.tr.texCoords.u=a.uvs[k.X3],c.tr.texCoords.v=a.uvs[k.Y3],c.br.texCoords.u=a.uvs[k.X4],c.br.texCoords.v=a.uvs[k.Y4]}}();